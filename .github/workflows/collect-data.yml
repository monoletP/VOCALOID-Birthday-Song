name: VOCALOID ë°ì´í„° ìˆ˜ì§‘

# ì–¸ì œ ì‹¤í–‰í• ì§€ ì„¤ì •
on:
  schedule:
    # 6,12ì›” 1ì¼ ì˜¤ì „ 6ì‹œ
    - cron: '0 21 1 6,12 *'

  # ìˆ˜ë™ìœ¼ë¡œë„ ì‹¤í–‰ ê°€ëŠ¥í•˜ê²Œ ì„¤ì •
  workflow_dispatch:
  
  # ì²˜ìŒ ì„¤ì •í•  ë•Œ pushë¡œë„ ì‹¤í–‰ë˜ê²Œ (í…ŒìŠ¤íŠ¸ìš©)
  push:
    paths:
      - 'collect_vocaloid_data.py'
      - '.github/workflows/collect-data.yml'

jobs:
  collect-data:
    runs-on: ubuntu-latest
    
    steps:
      # 1. ì €ì¥ì†Œ ì½”ë“œ ê°€ì ¸ì˜¤ê¸°
      - name: ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v4
        with:
          # ë³€ê²½ì‚¬í•­ì„ pushí•˜ê¸° ìœ„í•´ token í•„ìš”
          token: ${{ secrets.GITHUB_TOKEN }}
      
      # 2. Python í™˜ê²½ ì„¤ì •
      - name: Python ì„¤ì •
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'
      
      # 3. í•„ìš”í•œ Python íŒ¨í‚¤ì§€ ì„¤ì¹˜
      - name: ì˜ì¡´ì„± ì„¤ì¹˜
        run: |
          python -m pip install --upgrade pip
          pip install requests
      
      # 4. ë°ì´í„° ìˆ˜ì§‘ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
      - name: VOCALOID ë°ì´í„° ìˆ˜ì§‘
        run: python collect_vocaloid_data.py
      
      # 5. ìˆ˜ì§‘ëœ ë°ì´í„°ë¥¼ Gitì— ì»¤ë°‹í•˜ê³  í‘¸ì‹œ
      - name: ë°ì´í„° ì—…ë°ì´íŠ¸ ì»¤ë°‹
        run: |
          git config --local user.email "41898282+github-actions[bot]@users.noreply.github.com"
          git config --local user.name "github-actions[bot]"
          git add data/
          if git diff --staged --quiet; then
            echo "ë³€ê²½ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤."
          else
            git commit -m "ğŸµ VOCALOID ë°ì´í„° ìë™ ì—…ë°ì´íŠ¸: $(date '+%Y-%m-%d %H:%M:%S')"
            git push
          fi